<form id="routerForm" class="row g-3">

  <!-- ROW 1 -->
  <div class="col-md-2">
    <label class="form-label">FG</label>
    <input name="fg" class="form-control uc" required>
  </div>
  <div class="col-md-3">
    <label class="form-label">CUSTOMER</label>
    <input name="customer" class="form-control uc" required>
  </div>
  <div class="col-md-3">
    <label class="form-label">ROUTER NO</label>
    <input name="router_no" class="form-control uc" required>
  </div>
  <div class="col-md-2">
    <label class="form-label">RACK NO</label>
    <input name="rack_no" class="form-control uc">
  </div>
  <div class="col-md-2">
    <label class="form-label">LOCATION</label>
    <input name="location" class="form-control uc">
  </div>

  <!-- ROW 3 -->
  <div class="col-md-3">
    <label class="form-label">ROUTER SUPPLIER</label>
    <input name="router_supplier" class="form-control uc">
  </div>
  <div class="col-md-3">
    <label class="form-label">ROUTER PR.NO</label>
    <input name="router_pr_no" class="form-control uc">
  </div>

  <!-- ROW 4 -->
  <div class="col-md-3">
    <label class="form-label">DATE RECEIVED</label>
    <input type="date" name="date_received" class="form-control">
  </div>
  <div class="col-md-3">
    <label class="form-label">ROUTER VALIDATION DT</label>
    <input type="date" name="router_validation_dt" class="form-control">
  </div>
  <div class="col-md-3">
    <label class="form-label">ROUTER RE-VALIDATION DT</label>
    <input type="date" name="router_revalidation_dt" class="form-control">
  </div>

  <!-- ROW 6 -->
  <div class="col-md-4">
    <label class="form-label">RECEIVED BY</label>
    <input name="received_by" class="form-control uc">
  </div>

</form>

<script>
/* Existing scripts kept the same */
document.querySelector('[name="router_validation_dt"]').addEventListener('change', e => {
  const dt = new Date(e.target.value);
  if (!isNaN(dt)) {
    dt.setFullYear(dt.getFullYear() + 1);
    document.querySelector('[name="router_revalidation_dt"]').value = dt.toISOString().slice(0,10);
  }
});

async function tryFetchrouterData() {
  const routerNo = document.querySelector('[name="router_no"]').value.trim().toUpperCase();
  const side = document.querySelector('[name="side"]').value.trim().toUpperCase();
  if (!routerNo || !side) return;

  const res = await fetch(`/api/received`);
  const list = await res.json();
  const match = list.find(r => r.router_no === routerNo && r.side === side);
  if (match) {
    const fields = ["rack_no","location",
      "router_supplier","router_pr_no","date_received","router_validation_dt","router_revalidation_dt",
      "condition_status","production_status"];
    fields.forEach(f => {
      if (match[f]) {
        const el = document.querySelector(`[name="${f}"]`);
        if (el) el.value = match[f];
      }
    });
  }
}

document.querySelector('[name="router_no"]').addEventListener('blur', tryFetchrouterData);
document.querySelector('[name="side"]').addEventListener('blur', tryFetchrouterData);
</script>
