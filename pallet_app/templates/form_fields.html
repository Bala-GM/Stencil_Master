<form id="palletForm" class="row g-3">

  <!-- ROW 1 -->
  <div class="col-md-2">
    <label class="form-label">FG</label>
    <input name="fg" class="form-control uc" required>
  </div>
  <div class="col-md-3">
    <label class="form-label">CUSTOMER</label>
    <input name="customer" class="form-control uc" required>
  </div>
  <div class="col-md-3">
    <label class="form-label">PALLET NO</label>
    <input name="pallet_no" class="form-control uc" required>
  </div>
    <div class="col-md-3">
    <label class="form-label">PALLET QTY</label>
    <input name="pallet_qty" class="form-control uc" required>
  </div>
  <div class="col-md-2">
    <label class="form-label">RACK NO</label>
    <input name="rack_no" class="form-control uc">
  </div>
  <div class="col-md-2">
    <label class="form-label">LOCATION</label>
    <input name="location" class="form-control uc">
  </div>

  <!-- ROW 3 -->
  <div class="col-md-3">
    <label class="form-label">PALLET SUPPLIER</label>
    <input name="pallet_supplier" class="form-control uc">
  </div>
  <div class="col-md-3">
    <label class="form-label">PALLET PR.NO</label>
    <input name="pallet_pr_no" class="form-control uc">
  </div>

  <!-- ROW 4 -->
  <div class="col-md-3">
    <label class="form-label">DATE RECEIVED</label>
    <input type="date" name="date_received" class="form-control">
  </div>
  <div class="col-md-3">
    <label class="form-label">PALLET VALIDATION DT</label>
    <input type="date" name="pallet_validation_dt" class="form-control">
  </div>
  <div class="col-md-3">
    <label class="form-label">PALLET RE-VALIDATION DT</label>
    <input type="date" name="pallet_revalidation_dt" class="form-control">
  </div>

  <!-- ROW 6 -->
  <div class="col-md-4">
    <label class="form-label">RECEIVED BY</label>
    <input name="received_by" class="form-control uc">
  </div>

</form>

<script>
/* Existing scripts kept the same */
document.querySelector('[name="pallet_validation_dt"]').addEventListener('change', e => {
  const dt = new Date(e.target.value);
  if (!isNaN(dt)) {
    dt.setFullYear(dt.getFullYear() + 1);
    document.querySelector('[name="pallet_revalidation_dt"]').value = dt.toISOString().slice(0,10);
  }
});

async function tryFetchpalletData() {
  const palletNo = document.querySelector('[name="pallet_no"]').value.trim().toUpperCase();
  const side = document.querySelector('[name="side"]').value.trim().toUpperCase();
  if (!palletNo || !side) return;

  const res = await fetch(`/api/received`);
  const list = await res.json();
  const match = list.find(r => r.pallet_no === palletNo && r.side === side);
  if (match) {
    const fields = ["pallet_qty","rack_no","location",
      "pallet_supplier","pallet_pr_no","date_received","pallet_validation_dt","pallet_revalidation_dt",
      "condition_status","production_status"];
    fields.forEach(f => {
      if (match[f]) {
        const el = document.querySelector(`[name="${f}"]`);
        if (el) el.value = match[f];
      }
    });
  }
}

document.querySelector('[name="pallet_no"]').addEventListener('blur', tryFetchpalletData);
document.querySelector('[name="side"]').addEventListener('blur', tryFetchpalletData);
</script>
